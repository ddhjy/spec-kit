---

description: "用于功能实现的任务清单模板"
---

# 任务（Tasks）：[FEATURE NAME]

**输入**：来自 `/specs/[###-feature-name]/` 的设计文档
**前置条件**：plan.md（必需）、spec.md（用户故事必需）、research.md、data-model.md、contracts/

**测试**：下方示例包含测试任务。测试是可选的——仅当功能规格说明明确要求测试时才包含。

**组织方式**：任务按用户故事分组，以便每个故事都能独立实现与独立测试。

## 格式：`[ID] [P?] [Story] 描述`

- **[P]**：可并行执行（不同文件、无依赖）
- **[Story]**：该任务归属哪个用户故事（例如 US1、US2、US3）
- 描述中必须包含精确文件路径

## 路径约定

- **单项目**：仓库根目录下 `src/`、`tests/`
- **Web 应用**：`backend/src/`、`frontend/src/`
- **移动端**：`api/src/`、`ios/src/` 或 `android/src/`
- 下方示例默认单项目结构——请按 plan.md 的结构调整

<!-- 
  ============================================================================
  重要：下方任务仅为示例，用于说明格式。
  
  /speckit.tasks 命令必须基于以下内容将其替换为真实任务：
  - spec.md 中的用户故事（含优先级 P1、P2、P3……）
  - plan.md 中的功能需求
  - data-model.md 中的实体
  - contracts/ 中的端点/事件
  
  任务必须按用户故事组织，以便每个故事都能：
  - 独立实现
  - 独立测试
  - 作为 MVP 增量交付
  
  不要在最终生成的 tasks.md 中保留这些示例任务。
  ============================================================================
-->

## 阶段 1：准备（共享基础设施）

**目的**：项目初始化与基础结构搭建

- [ ] T001 按实现计划创建项目结构
- [ ] T002 初始化 [language] 项目并加入 [framework] 依赖
- [ ] T003 [P] 配置 lint 与格式化工具

---

## 阶段 2：基础设施（阻塞性前置条件）

**目的**：在开始任何用户故事实现之前必须完成的核心基础设施

**⚠️ 关键**：在本阶段完成之前，不得开始任何用户故事工作

基础设施任务示例（请按你的项目调整）：

- [ ] T004 搭建数据库 schema 与迁移框架
- [ ] T005 [P] 实现认证/授权框架
- [ ] T006 [P] 搭建 API 路由与中间件结构
- [ ] T007 创建所有故事依赖的基础 models/entities
- [ ] T008 配置错误处理与日志基础设施
- [ ] T009 配置环境配置管理

**检查点**：基础设施就绪——现在可以并行启动用户故事实现

---

## 阶段 3：用户故事 1 - [标题]（优先级：P1）🎯 MVP

**目标**：[简要描述该故事交付什么]

**独立测试**：[如何验证该故事可独立工作]

### 用户故事 1 的测试（可选——仅当规格要求测试时）⚠️

> **注意：先写测试，并确保在实现前测试是失败的**

- [ ] T010 [P] [US1] 为 [endpoint] 编写 contract 测试：tests/contract/test_[name].py
- [ ] T011 [P] [US1] 为 [user journey] 编写集成测试：tests/integration/test_[name].py

### 用户故事 1 的实现

- [ ] T012 [P] [US1] 在 src/models/[entity1].py 创建 [Entity1] model
- [ ] T013 [P] [US1] 在 src/models/[entity2].py 创建 [Entity2] model
- [ ] T014 [US1] 在 src/services/[service].py 实现 [Service]（依赖 T012、T013）
- [ ] T015 [US1] 在 src/[location]/[file].py 实现 [endpoint/feature]
- [ ] T016 [US1] 添加校验与错误处理
- [ ] T017 [US1] 为用户故事 1 的关键操作添加日志

**检查点**：此时用户故事 1 应当完全可用，并可独立测试

---

## 阶段 4：用户故事 2 - [标题]（优先级：P2）

**目标**：[简要描述该故事交付什么]

**独立测试**：[如何验证该故事可独立工作]

### 用户故事 2 的测试（可选——仅当规格要求测试时）⚠️

- [ ] T018 [P] [US2] 为 [endpoint] 编写 contract 测试：tests/contract/test_[name].py
- [ ] T019 [P] [US2] 为 [user journey] 编写集成测试：tests/integration/test_[name].py

### 用户故事 2 的实现

- [ ] T020 [P] [US2] 在 src/models/[entity].py 创建 [Entity] model
- [ ] T021 [US2] 在 src/services/[service].py 实现 [Service]
- [ ] T022 [US2] 在 src/[location]/[file].py 实现 [endpoint/feature]
- [ ] T023 [US2] 与用户故事 1 的组件集成（如需要）

**检查点**：此时用户故事 1 和 2 都应能独立工作

---

## 阶段 5：用户故事 3 - [标题]（优先级：P3）

**目标**：[简要描述该故事交付什么]

**独立测试**：[如何验证该故事可独立工作]

### 用户故事 3 的测试（可选——仅当规格要求测试时）⚠️

- [ ] T024 [P] [US3] 为 [endpoint] 编写 contract 测试：tests/contract/test_[name].py
- [ ] T025 [P] [US3] 为 [user journey] 编写集成测试：tests/integration/test_[name].py

### 用户故事 3 的实现

- [ ] T026 [P] [US3] 在 src/models/[entity].py 创建 [Entity] model
- [ ] T027 [US3] 在 src/services/[service].py 实现 [Service]
- [ ] T028 [US3] 在 src/[location]/[file].py 实现 [endpoint/feature]

**检查点**：此时所有用户故事都应能独立工作

---

[按需添加更多用户故事阶段，沿用相同模式]

---

## 阶段 N：打磨与横切关注点

**目的**：影响多个用户故事的改进项

- [ ] TXXX [P] 更新 docs/ 中的文档
- [ ] TXXX 代码清理与重构
- [ ] TXXX 跨所有故事的性能优化
- [ ] TXXX [P] 追加单元测试（如需要）：tests/unit/
- [ ] TXXX 安全加固
- [ ] TXXX 运行 quickstart.md 验证

---

## 依赖与执行顺序

### 阶段依赖

- **准备（阶段 1）**：无依赖——可立即开始
- **基础设施（阶段 2）**：依赖准备阶段完成——会阻塞所有用户故事
- **用户故事（阶段 3+）**：都依赖基础设施阶段完成
  - 之后可并行推进（若人员充足）
  - 或按优先级顺序串行推进（P1 → P2 → P3）
- **打磨（最终阶段）**：依赖所有需要的用户故事完成

### 用户故事依赖

- **用户故事 1（P1）**：基础设施（阶段 2）完成后即可开始——不依赖其他故事
- **用户故事 2（P2）**：基础设施（阶段 2）完成后即可开始——可与 US1 集成，但应保持可独立测试
- **用户故事 3（P3）**：基础设施（阶段 2）完成后即可开始——可与 US1/US2 集成，但应保持可独立测试

### 单个用户故事内部顺序

- 测试（如包含）必须先写，并在实现前失败
- 先 models，再 services
- 先 services，再 endpoints
- 先核心实现，再集成
- 当前故事完成后再进入下一个优先级

### 可并行的机会点

- 准备阶段中标记 [P] 的任务可并行
- 基础设施阶段中标记 [P] 的任务可并行（阶段 2 内）
- 基础设施完成后，所有用户故事可并行启动（如团队容量允许）
- 单个用户故事中标记 [P] 的测试可并行
- 单个用户故事中标记 [P] 的 models 可并行
- 不同用户故事可由不同团队成员并行推进

---

## 并行示例：用户故事 1

```bash
# 同时启动用户故事 1 的所有测试（如果要求测试）：
Task: "Contract test for [endpoint] in tests/contract/test_[name].py"
Task: "Integration test for [user journey] in tests/integration/test_[name].py"

# 同时启动用户故事 1 的所有 models：
Task: "Create [Entity1] model in src/models/[entity1].py"
Task: "Create [Entity2] model in src/models/[entity2].py"
```

---

## 实施策略

### 先做 MVP（仅用户故事 1）

1. 完成阶段 1：准备
2. 完成阶段 2：基础设施（关键——阻塞所有故事）
3. 完成阶段 3：用户故事 1
4. **停止并验证**：独立测试用户故事 1
5. 若准备就绪则部署/演示

### 增量交付

1. 完成准备 + 基础设施 → 基础就绪
2. 加入用户故事 1 → 独立测试 → 部署/演示（MVP！）
3. 加入用户故事 2 → 独立测试 → 部署/演示
4. 加入用户故事 3 → 独立测试 → 部署/演示
5. 每个故事都在不破坏前序故事的前提下增加价值

### 团队并行策略

当有多名开发者时：

1. 团队共同完成准备 + 基础设施
2. 基础设施完成后：
   - 开发者 A：用户故事 1
   - 开发者 B：用户故事 2
   - 开发者 C：用户故事 3
3. 各故事独立完成并独立集成

---

## 备注

- [P] 任务：不同文件、无依赖、可并行
- [Story] 标签：将任务映射到具体用户故事，便于追溯
- 每个用户故事都应能独立完成与独立测试
- 实现前先确认测试失败（如包含测试）
- 每个任务或一个逻辑组完成后提交一次
- 在任意检查点可暂停并独立验证当前故事
- 避免：模糊任务、同一文件冲突、破坏独立性的跨故事依赖
